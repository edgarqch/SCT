{% extends "base/base_site.html" %}

{% block title %} Verificar Renovación {% endblock title %}

{% block js %}

{% endblock js %}
 
{% block content %}
<div class="right_col" role="main">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="title_left" >
          <h3>Renovación</h3>
        </div>
        <div class="x_panel">
            <h4>Proceso de Verificación</h4>
            <div class="x_content">
                <div class="">
                    <div class="">
                        <div class="" role="tabpanel" data-example-id="togglable-tabs">
                          <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                            <li role="presentation" class="active">
                              <a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">
                                <label class="form-label">Agregados</label>
                                <span class="badge bg-blue">{{operador_n.count}}</span>
                              </a>
                            </li>
                            <li role="presentation" class="">
                              <a href="#tab_content2" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">
                                <label class="form-label">Verificación</label>
                                <span class='badge bg-green' >{{operador_v.count}}</span>
                              </a>
                            </li>
                            <li role="presentation" class="">
                              <a href="#tab_content3" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">
                                <label class="form-label">Informes</label>
                                <span class='badge bg-purple' >{{operador_inf.count}}</span>
                              </a>
                            </li>
                          </ul>
                          <div id="myTabContent" class="tab-content">
                            <div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">
                              <p>
                                <div id="datatable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                                  <div class="row">
                                    <div class="col-sm-12">
                                      <table class="table table-striped table-bordered prueba dt-responsive display nowrap jambo_table" cellpadding="0" width="100%">
                                        <thead>
                                          <tr class="headings" >
                                            <th  style="width: 25%;">ACCIONES</th>
                                            <th  style="width: 45%;">NOMBRE</th>
                                            <th  style="width: 30%;">RAZON SOCIAL</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                            {% if operador_n %}
                                            {% for operario in operador_n %}
                                            <tr>
                                                <td>
                                                    {% if operario.notaFenecio %}
                                                        <a class="btn btn-primary" data-toggle="tooltip" title="Actualizar" href="{% url 'tecnico:nota_renovacion_editar' pk=operario.notaFenecio.id fk=operario.id %}">Actualizar Nota</a>
                                                        <a class="btn btn-info" data-toggle="tooltip" title="Asignar Vehículos" href="{% url 'tecnico:operador_renovacion' pk=operario.id %}">Vehículos</a>
                                                    {% else %}
                                                        <a class="btn btn-primary" data-toggle="tooltip" title="Nota" href="{% url 'tecnico:nota_renovar' pk=operario.id %}">Añadir Nota</a>
                                                    {% endif %}
                                                </td>
                                                <td>{{ operario.nombre }}</td>
                                                <td>{{ operario.razon_social }}</td>
                                            </tr>
                                            {% endfor %}
                                            {% else %}
                                            
                                            {% endif %}
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                </div>
                                <p>
                                  <a class="btn btn-app" style="color: white; background:rgb(25, 204, 159)" title="Agregar Operador" data-toggle="tooltip" href="{% url 'tecnico:seleccionar_operadores' %}"><i class="fa fa-plus"></i>AGREGAR OPERADOR</a>
                                  <!-- <button class="btn btn-app" id="solicitante"><i class="fa fa-edit"></i>Elegir Operador</button> -->
                                </p>
                              </p>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="tab_content2" aria-labelledby="profile-tab">
                              <p>
                                <div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                                  <div class="row">
                                    <div class="col-sm-12">
                                      <table class="table table-striped table-bordered prueba dt-responsive display nowrap jambo_table" cellpadding="0" width="100%">
                                      <!-- <table id="myTable2" class="table table-striped table-bordered prueba"> -->
                                        <thead >
                                          <tr class="headings" style='background-color: rgba(63,83,103,1); color:white;'>
                                              <th style="width: 20%;">ACCIONES</th>
                                              <th style="width: 50%;">NOMBRE</th>
                                              <th style="width: 30%;">RAZON SOCIAL</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          {% if operador_v %}
                                          {% for operador in operador_v %}
                                          <tr>
                                            <td>
                                              <a class="btn btn-info" href="{% url 'tecnico:operador_renovando' pk=operador.id %}">
                                                    Verificar                               
                                              </a>
                                            </td>
                                            <td>{{ operador.nombre }}</td>
                                            <td>{{ operador.razon_social }}</td>
                                            </tr>
                                            {% endfor %}
                                            {% else %}
                                            
                                            {% endif %}
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                                </p>
                              </div>
                              <div role="tabpanel" class="tab-pane fade" id="tab_content3" aria-labelledby="profile-tab">
                                <p>
                                  <div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                                    <div class="row">
                                      <div class="col-sm-12">
                                        <table class="table table-striped table-bordered prueba dt-responsive display nowrap jambo_table" cellpadding="0" width="100%">
                                          <thead >
                                            <tr class="headings" style='background-color: rgba(63,83,103,1); color:white;'>
                                                <th style="width: 20%;">ACCIONES</th>
                                                <th style="width: 50%;">NOMBRE</th>
                                                <th style="width: 30%;">RAZON SOCIAL</th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                              {% if operador_inf %}
                                              {% for operador in operador_inf %}
                                              <tr>
                                                <td>
                                                    {% if operador.tienevehiobsRenovacion %}
                                                      {% if operador.estaobservado %}
                                                        <a class="btn btn-warning" href="{% url 'tecnico:informe_obs_renovando' pk=operador.id %}">Emitir Observación</a>
                                                        {% if not operador.sedevolvio %}
                                                            <a class="btn btn-danger" href="{% url 'tecnico:emitir_informe_renovacion' pk=operador.id tip=2 %}">Nota de Devolución</a>
                                                        {% else %}
                                                            <a class="btn btn-danger" href="{% url 'tecnico:informe_devol_renovando' pk=operador.id %}">Devolución</a>
                                                        {% endif %}
                                                      {% else %}
                                                        <a class="btn btn-warning" href="{% url 'tecnico:emitir_informe_renovacion' pk=operador.id tip=1 %}">Emitir Observación</a>
                                                      {% endif %}
                                                    {% else %}
                                                      {% if not operador.tieneInformeTecnico %}
                                                        <a class="btn btn-primary" href="{% url 'tecnico:emitir_informe_renovacion' pk=operador.id tip=3 %}">Emitir Informe Técnico</a>
                                                      {% else %}    
                                                        <a target="_black" class="btn btn-primary" href="{% url 'tecnico:informe_tecnico_renovando' pk=operador.id %}">Informe Técnico</a>
                                                    {% endif %}
                                                  {% endif %}
                                                </td>
                                                <td>{{ operador.nombre }}</td>
                                                <td>{{ operador.razon_social }}</td>
                                              </tr>
                                              {% endfor %}
                                              {% else %}
                                              
                                              {% endif %}
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                                </p>
                              </div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  <!-- Modal Buscar operador (Solicitant) -->
  <div id="modal-buscar-operador" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">X</span></button>
            <h4 class="modal-title" id="myModalLabel">Buscar Operador</h4>
          </div>
          <div class="modal-body">
            <div class="form-horizontal form-label-left">
              <div class="form-group has-feedback">
                <label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre del operador</label>
                <div class="col-md-9 col-sm-9 col-xs-12">
                  <input type="text" class="form-control has-feedback-right" id="modal_search_operador_nombre" placeholder="Buscar por nombre..." name="">
                  <span class="fa fa-search form-control-feedback right" aria-hidden="true"></span>
                </div>
              </div>
            </div>

            <div>
              <hr>
              <p>Resultados: </p>
              <div class="modal-result">
                <div class="list-group" id='modal_list_result'>
                  <!-- Loaded from Ajax method -->
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-dark" id="modal_btn_load">Seleccionar</button>
            <button type="button" class="btn btn-default" id="modal_btn_close" data-dismiss="modal">Cerrar</button>
          </div>
      </div>
    </div>
  </div>

</div>
{% endblock content %}
{% block javascripts %}
{{ block.super }}
<script src="/static/js/project.js"></script>
<script src="/static/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="/static/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="/static/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="/static/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="/static/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="/static/vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="/static/js/responsive.bootstrap.js"></script>
<script src="/static/vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
<!-- validator -->
<script src="/static/vendors/validator/validator.js"></script>
<script type="text/javascript">
  $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
          //$.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();
      $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
  } );
$(function() {
  $('.prueba').DataTable( {
    "scrollY":        "300px",
    "scrollCollapse": true,
    "paging":         true,
    "responsive":     true,
    "ordering":       true,
    "language": {
        "sProcessing":     "Procesando...",
        "sLengthMenu":     "Mostrar _MENU_ registros",
        "sZeroRecords":    "No se encontraron resultados",
        "sEmptyTable":     "Ningún dato disponible en esta tabla",
        "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
        "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
        "sInfoPostFix":    "",
        "sSearch":         "Buscar:",
        "sUrl":            "",
        "sInfoThousands":  ",",
        "sLoadingRecords": "Cargando...",
        "oPaginate": {
            "sFirst":    "Primero",
            "sLast":     "Último",
            "sNext":     "Siguiente",
            "sPrevious": "Anterior"
        },
        "oAria": {
            "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
        }
    }
  } );

  // Intento, de poner un operador para renovacion de tarjetas
  $('#solicitante').on('click', function() {
    buscar_operador_by_nombre('');
    $('#modal-buscar-operador').modal('show');
  });

  $('#modal_search_operador_nombre').keyup(function(e){
    consulta = $('#modal_search_operador_nombre').val();
    buscar_operador_by_nombre(consulta);
  });

  function buscar_operador_by_nombre(consulta) {
    $.ajax({
      data: {'name': consulta},
      url: '/tecnico/buscar_operador/',
      type: 'get',
      success: function(data) {
        var sms = "";
        $('#modal_list_result').html("");
        for(var i = 0; i < data.length; i++) {
          sms += data[i].id + '\n';
          var html = "<a href='#' class='list-group-item'>";
          html += "<h4 class='list-group-item-heading'>" + data[i].nombre + "</h4>";
          html += "<p style='display:none' >" + data[i].id + "</p>";
          html += "</a>";
          $('#modal_list_result').append(html);
        }
      },
      error: function(message) {
        console.log(message);
      },
    });
  }

  $('#modal_list_result').on('click', '.list-group-item', function(){
    $('.list-group-item').each(function(i) {
      $(this).removeClass('active');
    });
    $(this).addClass('active');
  });

  $('#modal_btn_load').on('click', function() {
    var sms = $('#modal_list_result .active p').html();
    var sms1 = $('#modal_list_result .active h4').html();
    $('#id_solicitante_ok').val(sms);
    $('#id_solicitante').val(sms1);
    $('#modal-buscar-operador').modal('hide');
  });

  $('#modal_list_result').on('dblclick', '.list-group-item', function(){
    var sms = $('#modal_list_result .active p').html();
    var sms1 = $('#modal_list_result .active h4').html();
    $('#id_solicitante_ok').val(sms);
    $('#id_solicitante').val(sms1);
    $('#modal-buscar-operador').modal('hide');
  });
  // Finaliza intento y no se aplicará
});
</script>
<style type="text/css">
.prueba{
  height: 150px;
}
</style>
{% endblock %}